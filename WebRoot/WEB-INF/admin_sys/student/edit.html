<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8" />
<title>学生信息管理系统</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta content="width=device-width, initial-scale=1" name="viewport" />
<meta content="" name="description" />
<meta content="" name="author" />
<!-- BEGIN GLOBAL MANDATORY STYLES -->
<#include "/admin_sys/head.html"/>

<link
	href="${base}/res/assets/global/plugins/datatables/datatables.min.css"
	rel="stylesheet" type="text/css">
<link
	href="${base}/res/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.css"
	rel="stylesheet" type="text/css">
	 <link href="${base}/res/assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css" />
    <link href="${base}/res/assets/global/plugins/bootstrap-fileinput/bootstrap-fileinput.css" rel="stylesheet" type="text/css" />
    <link href="${base}/res/assets/global/plugins/bootstrap-select/css/bootstrap-select.min.css" rel="stylesheet" type="text/css" />
       <link href="${base}/res/assets/global/plugins/icheck/skins/all.css" rel="stylesheet" type="text/css" />
<script type="text/javascript">
function getTableForm() {
	return document.getElementById('tableForm');
}
</script>
</head>
<!-- END HEAD -->

<body
	class="page-header-fixed page-sidebar-closed-hide-logo page-container-bg-solid page-md">
	<!-- BEGIN HEADER -->
	<#include "/admin_sys/top.html"/>
	<!-- END HEADER -->
	<!-- BEGIN HEADER & CONTENT DIVIDER -->
	<div class="clearfix"></div>
	<!-- END HEADER & CONTENT DIVIDER -->
	<!-- BEGIN CONTAINER -->
	<div class="page-container">
		<!-- BEGIN SIDEBAR -->
		<#assign tb_12=true />
			<#assign tb_12_ul=true  />
			<#assign tb_12_li_1=true />
			<#assign tb_12_arrow=true />
		<#include "/admin_sys/left.html"/>
		<!-- END SIDEBAR -->
		<div class="page-content-wrapper">
			<!-- BEGIN CONTENT BODY -->
			<div style="min-height:1022px" class="page-content">
				<!-- page bar start -->
				<div class="page-bar">

					<ul class="page-breadcrumb">
						<li><a href="v_list.do">学生管理</a> <i class="fa fa-angle-right"></i>
						</li>
						<li><span>学生列表</span></li>
					</ul>
				</div>

				<div class="row ">
					<div class="col-md-12">
						<!-- BEGIN SAMPLE FORM PORTLET-->
				
						<!-- END SAMPLE FORM PORTLET-->
					</div>
				</div>

				<div class="row">
					<div class="col-md-12">
						<!-- BEGIN SAMPLE TABLE PORTLET-->
						<div class="portlet box blue">
							<div class="portlet-title">
								<div class="caption">
									<i class="fa fa-comments"></i>编辑学生信息
								</div>
								<div class="actions">
									<a href="v_list.do"  class="btn green"> <i class="fa fa-check"></i>返回</a>
								</div>
							</div>

							
								<form id="tableForm" method="post" novalidate="novalidate" action="o_update.do" enctype="multipart/form-data"
									class="form-horizontal form-row-seperated">
									<input type="hidden" name="id" value="${student.id}"/>
									<div class="form-body">
									<div class="form-body">
                                    <div class="alert alert-danger display-hide">
                                        <button class="close" data-close="alert"></button>
                                                                                                               请仔细检查输入的学生信息！
                                    </div>
                                    <#if errors??>
                                        <div class="alert alert-danger" role="alert">
                                            <button class="close" data-close="alert"></button>
                                            <#list errors as error> ${error}<br/></#list>
                                        </div>
                                    </#if>
                                </div>
									
						        <div class="col-md-12">
                            <!-- BEGIN BORDERED TABLE PORTLET-->
                            <div class="portlet light portlet-fit bordered">
                                <div class="portlet-title">
                                    <div class="caption">
                                        <i class="icon-bubble font-dark"></i>
                                        <span class="caption-subject font-dark bold uppercase">填写学生信息</span>
                                    </div>
                                
                                </div>
                                <div class="portlet-body">
                                    <div class="table-scrollable">
                                        <table class="table table-bordered">
                                           
                                            <tbody>
                                                <tr>
                                                    <td >姓名 </td>
                                                    <td>
                                                     <span class="required"></span>
                                                     <div class="form-group">
                                                       <input type="text" class="form-control input-inline input-medium" placeholder="" name="name" id="name" value="${student.name!}">
                                                
                                                     </div></td>
                                                    <td>学号</td>
                                                    <td> 
                                                      <span class="required"></span>
                                                       <div class="form-group">
                                                     <input type="text" class="form-control input-inline input-medium" placeholder="" name="schoolNumber" id="schoolNumber" value="${student.schoolNumber!}">
                                                      </div></td>
                                                    <td> 性别</td>
                                                    <td >
                                                           <div class="form-group" >
                                                                    <div class="input-group">
                                                                        <div class="icheck-inline" >
                                                                            <label>
                                                                                <input type="radio" name="gender" class="icheck" value="1"> 男</label>
                                                                            <label>
                                                                                <input type="radio" name="gender" class="icheck" value="0"> 女 </label>
                                                                        </div>
                                                                    </div>
                                                            </div>
                                                    </td>
                                                    <td rowspan="3">
                                                    <span class="required"></span>
                                                     <div class="form-group">
                                                    <div class="col-md-9">
                                                    <div class="fileinput fileinput-new" data-provides="fileinput">
                                                        <div class="fileinput-preview thumbnail" data-trigger="fileinput" style="width: 200px; height: 150px;">
                                                        <#if student.miniUrl??>
                                                        <img src="${base}${student.miniUrl}" class="img-responsive" alt="">
                                                        </#if>
                                                         </div>
                                                        <div>
                                                            <span class="btn red btn-outline btn-file">
                                                                <span class="fileinput-new"> 上传头像 </span>
                                                                 <span class="fileinput-exists">重新选择</span> 
                                                                <input type="file" name="photo" id="photo"></span>
                                                            <a href="javascript:;" class="btn red fileinput-exists" data-dismiss="fileinput">移除</a>
                                                        </div>
                                                    </div>
                                                </div>
                                                </div></td>
                                                </tr>
                                                <tr>
                                                    <td> 专业 </td>
                                                    <td> 
                                                        <select class="form-control input-small input-inline" data-style="btn-primary" name="departmentList" id="departmentList">
                                                           <option value="">院系</option>
                                                           <#list departmentList as department>
                                                            <option value="${department.id}">${department.name!}</option>
                                                           </#list>
                                                        </select>
                                                        <select class="form-control input-small input-inline" data-style="btn-success" name="majorList" id="majorList">
                                                        <option value="">专业</option>
                                                        <#list majorList as major>
                                                            <option value="${major.id}">${major.name!}</option>
                                                        </#list>
                                                        </select> 
                                                       <select class="form-control input-small input-inline" data-style="btn-success" name="classList" id="classList">
                                                        <option value="">班级</option>
                                                        <#list classList as class>
                                                            <option value="${class.id}">${class.className!}</option>
                                                        </#list>
                                                        </select> 
                                                        
                                                        </td>
                                                    <td> 民族 </td>
                                                    <td>
                                                    <span class="required"></span>
                                                     <div class="form-group">
                                                    <input type="text" class="form-control input-inline input-medium" placeholder="" name="nation" id="nation" value="${student.nation!}"></div> </td>
                                                    <td>政治面貌</td>
                                                    <td>
                                                    <span class="required"></span>
                                                     <div class="form-group ">
                                                     <input type="text" class="form-control input-inline input-medium" placeholder="" name="political_status" id="political_status" value="${student.political_status!}"></div> 
                                                </tr>
                                                <tr>
                                                    <td>曾用名</td>
                                                    <td><input type="text" class="form-control input-inline input-medium" placeholder="" name="nickname" id="nickname" value="${student.nickname!}"> </td>
                                                    <td>身份证 </td>
                                                    <td> 
                                                    <span class="required"></span>
                                                     <div class="form-group">
                                                    <input type="text" class="form-control input-inline input-medium" placeholder="" name="ID" id="ID" value="${student.ID!}"></div> </td>
                                                    <td>出生日期</td>
                                                    <td>
                                                    <span class="required"></span>
                                                     <div class="form-group">
                                                    <input type="text" class="form-control input-inline input-medium" placeholder="xxxx-xx-xx" name="birthday" id="birthday" value="${student.birthday?string("yyyy-MM-dd")}"></div></td>
                                                </tr>
                                                <tr>
                                                    <td>籍贯</td>
                                                    <td>
                                                    <span class="required"></span>
                                                     <div class="form-group">
                                                    <input type="text" class="form-control input-inline input-medium" placeholder="" name="native" id="native" value="${student.native!}"> </div></td>
                                                    <td>入学年份 </td>
                                                    <td> 
                                                    <span class="required"></span>
                                                     <div class="form-group">
                                                    <input type="text" class="form-control input-inline input-medium" placeholder="xxxx-xx-xx" name="entranceTime" id="entranceTime" value="${student.entranceTime?string("yyyy-MM-dd")}"></div></td>
                                                    <td>学历</td>
                                                    <td>
                                                    <span class="required"></span>
                                                     <div class="form-group">
                                                    <input type="text" class="form-control input-inline input-medium" placeholder="" name="education" id="education" value="${student.education!}"></div></td>
                                                </tr>
                                                 <tr>
                                                    <td>家庭地址</td>
                                                    <td colspan="3">
                                                    <span class="required"></span>
                                                     <div class="form-group">
                                                    <input type="text" class="form-control" placeholder="" name="address" id="address" value=" ${student.address!}"></div></td>
                                                    <td>家庭电话</td>
                                                    <td> 
                                                    <span class="required"></span>
                                                     <div class="form-group">
                                                    <input type="text" class="form-control input-inline input-medium" placeholder="" name="homePhone" id="homePhone" value="${student.homePhone!}"></div></td>
                                                   
                                                </tr>
                                                   <tr>
                                                    <td>邮政编码</td>
                                                    <td>
                                                    <span class="required"></span>
                                                     <div class="form-group">
                                                    <input type="text" class="form-control input-inline input-medium" placeholder="" name="postalcode" id="postalcode" value="${student.postalcode!}"></div> </td>
                                                    <td>本人联系方式 </td>
                                                    <td>
                                                    <span class="required"></span>
                                                     <div class="form-group">
                                                    <input type="text" class="form-control input-inline input-medium" placeholder="" name="selfPhone" id="selfPhone" value="${student.selfPhone!}"></div></td>
                                                    <td>邮箱</td>
                                                    <td>
                                                    <span class="required"></span>
                                                     <div class="form-group">
                                                    <input type="text" class="form-control input-inline input-medium" placeholder="" name="email" id="email" value="${student.email!}"></div></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <!-- END BORDERED TABLE PORTLET-->
                        </div>
                                  <div class="form-actions">
										<div class="row">
											<div class="col-md-offset-6 col-md-6">
												<button type="submit"  class="btn  btn-primary" >
													<i class="fa fa-check"></i> 提交
												</button>
											</div>
										</div>
									</div>
                        </div>
                       
                        </form>


						</div>
						<!-- END SAMPLE TABLE PORTLET-->
					</div>

				</div>

			</div>
		</div>
		<!-- BEGIN CONTENT -->

 <script type="text/javascript">
          var departmentEle = document.getElementById("departmentList");
          var majorEle = document.getElementById("majorList")
          departmentEle.onchange = function(){
              // 清空
              var majors = document.getElementById("majorList");
              var opts = majors.getElementsByTagName("option");
              for(var z=opts.length-1;z>0;z--){
                  majors.removeChild(opts[z]);
              }
              if(departmentEle.value != "院系"){
                  // 2. 执行Ajax异步请求
                  var xhr = getXhr();
                  xhr.open("post","ajaxMajor.do");
                  xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
                  xhr.send("id="+departmentEle.value);
              }else{
              	var xhr = getXhr();
                  xhr.open("post","ajaxMajor.do");
                  xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
                  xhr.send("id="+"");
              }
                  xhr.onreadystatechange = function(){
                      if(xhr.readyState==4&&xhr.status==200){
                          // 接收服务器端的数据内容
                          var data = xhr.responseText;
                          // data是字符串,转换为数组
                          var index = data.indexOf("=");
                          var majorNames = data.substring(0, index).split(',');
                          var majorIds = data.substring(index+1).split(',');
                          for(var i=0;i<majorNames.length;i++){
                              var option = document.createElement("option");
                              option.value = majorIds[i];
                              var textNode = document.createTextNode(majorNames[i]); 
                              option.appendChild(textNode);
                              majors.appendChild(option);
                          }
                      }
                  };
              
          };
          
          majorEle.onchange = function(){
              // 清空
              var classs = document.getElementById("classList");
              var opts = classs.getElementsByTagName("option");
              for(var z=opts.length-1;z>0;z--){
                  classs.removeChild(opts[z]);
              }
              if(majorEle.value != "院系"){
                  // 2. 执行Ajax异步请求
                  var xhr = getXhr();
                  xhr.open("post","ajaxClass.do");
                  xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
                  xhr.send("id="+majorEle.value);
              }else{
              	var xhr = getXhr();
                  xhr.open("post","ajaxClass.do");
                  xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
                  xhr.send("id="+"");
              }
                  xhr.onreadystatechange = function(){
                      if(xhr.readyState==4&&xhr.status==200){
                          // 接收服务器端的数据内容
                          var data = xhr.responseText;
                          // data是字符串,转换为数组
                          var index = data.indexOf("=");
                          var classNames = data.substring(0, index).split(',');
                          var classIds = data.substring(index+1).split(',');
                          for(var i=0;i<classNames.length;i++){
                              var option = document.createElement("option");
                              option.value = classIds[i];
                              var textNode = document.createTextNode(classNames[i]); 
                              option.appendChild(textNode);
                              classs.appendChild(option);
                          }
                      }
                  };
              
          };
          function getXhr(){
        	    var xhr = null;
        	    if(window.XMLHttpRequest){
        	        xhr = new XMLHttpRequest();
        	    }else{
        	        xhr = new ActiveXObject("Microsoft.XMLHttp");
        	    }
        	    return xhr;
        	} 
          
          $(function(){
        	  $(":radio[name=gender][value='${student.gender}']").attr("checked","checked");
        	  $(":radio[name=gender][value='${student.gender}']").parent().parent().parent().parent().parent().attr("class","checked");
        	  $('#departmentList').val('${student.major.department.id}');
        	  $('#majorList').val('${student.major.id}');
        	  $('#classList').val('${student.bclass.id}');
          });
		</script>
		




		<#include "/common/bootAlert_message.html"/>
		<!-- END CONTENT -->
		<script src="${base}/res/assets/global/plugins/bootstrap-select/js/bootstrap-select.min.js" type="text/javascript"></script>
			<script src="${base}/res/assets/global/plugins/bootstrap-fileinput/bootstrap-fileinput.js" type="text/javascript"></script>
			 <script src="${base}/res/assets/pages/scripts/components-bootstrap-select.min.js" type="text/javascript"></script>
			 <script src="${base}/res/assets/global/plugins/icheck/icheck.min.js" type="text/javascript"></script>
			 
			 <script
			src="${base}/res/assets/global/plugins/jquery-validation/js/jquery.validate.min.js"
			type="text/javascript"></script>
		<script
			src="${base}/res/assets/global/plugins/jquery-validation/js/localization/messages_zh.js"></script>
		<script
			src="${base}/res/assets/global/plugins/jquery-validation/js/additional-methods.min.js"
			type="text/javascript"></script>
			<script src="${base}/res/assets/js/studentinfo_edit_validation.js" type="text/javascript"></script>
           <script src="${base}/res/assets/global/plugins/jquery-validation/js/localization/messages_zh.js"></script>
	</div>
	<!-- END CONTAINER -->
</body>

</html>